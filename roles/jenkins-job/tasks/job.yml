- name: Check if job exists
  shell: "{{JENKINS_CLI_PREFIX}} get-job {{item.name}}"
  ignore_errors: true
  regster: check_job


- name: Generate unique string
  shell: date | md5sum | awk '{ print $1 }'
  register: unique_string

- name: update job template
  template:
    src: job.xml
    dest: /tmp/job.xml

- name: Create a Job
  when: check_job.rc == 3
  shell: "cat tmp/job.yml | {{JENKINS_CLI_PREFIX}} create-job {{item.name}}"

#- name: Update job
#  when: check_job.rc == 0